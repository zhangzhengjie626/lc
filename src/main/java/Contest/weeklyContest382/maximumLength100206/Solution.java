package Contest.weeklyContest382.maximumLength100206;

import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Map;

public class Solution {
    public int maximumLength(int[] nums) {
        Map<Integer, Integer> map = new HashMap<>();
        Map<Integer, Integer> mapBak = new HashMap<>();
        HashSet<Integer> set = new HashSet<>();
        for (int i = 0; i < nums.length; i++) {
            Integer orDefault = map.getOrDefault(nums[i], 0);
            map.put(nums[i], orDefault + 1);
            set.add(nums[i]);
            mapBak.put(nums[i], orDefault + 1);
        }
        boolean isDouble = false;
        for (Map.Entry<Integer, Integer> e : map.entrySet()) {
            if (e.getValue() >= 2) {
                isDouble = true;
            }
        }
        if (!isDouble) {
            return 1;
        } else {
            int ans = 1;
            Iterator<Integer> iter = set.iterator();
            while (iter.hasNext()) {
                int tmpAns = 1;
                int i1 = iter.next();
                HashSet<Integer> bak = new HashSet<>();
                bak.add(i1);
                map.put(i1, map.get(i1) - 1);//第一次错
                while (true) {
                    double sqrt = Math.sqrt(i1);
                    int sqrtInt = (int) sqrt;
                    if (map.containsKey(sqrtInt) && map.get(sqrtInt) >= 2 && sqrtInt * sqrtInt == i1) {
                        bak.add(sqrtInt);
                        map.put(sqrtInt, map.get(sqrtInt) - 2);
                        tmpAns += 2;
                    } else {
                        //还原map

                        Iterator<Integer> iterator = bak.iterator();
                        while (iterator.hasNext()) {
                            Integer next = iterator.next();
                            map.put(next, mapBak.get(next));
                        }
                        bak.clear();
                        break;
                    }
                    i1 = sqrtInt;
                }
                ans = Math.max(tmpAns, ans);
            }
            return ans;
        }
    }
}
//第一次忘记排除自己
//开根号出问题了  根号2变成1了
//第三次超时了
//第四次超时

/**
 * [5184,529,225,3418801,40,74805201,6241,144,707281,196,2304,3025,43,65,3,441,92236816,3600,44,96059601,9150625,6561,49,9,1185921,86,8464,7569,4489,71,2704,60,5776,8281,1936,6561,92236816,923521,81,19,144,38,3418801,70,2,43046721,38416,4879681,66,4225,82,6084,41,9,16,40,5929,50,96,2085136,2209,7921,900,1444,65610000,2,59,36,55,54,85,26873856,28398241,121,16777216,58,576,4,47458321,4225,45212176,67,961,2304,11316496,331776,44,3844,60,19,160000,815730721,21381376,32,31,50,5329,225,3025,7311616,66,49,64,3748096,17,234256,11,50,8649,104976,65536,6889,65610000,65536,32,38416,18974736,5308416,10000,1296,47458321,2916,38,48,72,1874161,9,78,3969,10000,21381376,24,43,38,7921,64,45212176,23,16,42,62742241,2500,6561,1089,81,196,1024,8649,8649,8503056,4096,69,324,68,5476,38,429981696,23,49,74805201,9,6250000,43046721,13,8503056,18974736,9150625,4096,24,74805201,53,69,64,256,13,17850625,100000000,76,923521,4356,6250000,47,53,3364,225,900,8836,9,9801,3481,41,10556001,214358881,4761,20151121,279841,5184,16777216,77,14,4356,43,214358881,50,44,24010000,59,10000,196,54700816,529,3844,7,2209,59,5764801,456976,900,81,256,3481,2500,48,6,9604,91,73,83521,68574961,10000,90,23,256,42,2116,20151121,29986576,12960000,41,4100625,676,43046721,31640625,196,1185921,256,100,9,31,815730721,4096,36,12117361,4,65536,65610000,11,2085136,38,24010000,2825761,62,361,8281,77,58,22667121,83521,5308416,57289761,62,16777216,3844,1681,1600,324,5625,2304,18,3969,68,4489,4096,9216,89,4879681,43046721,6084,2401,14,2500,16777216,63,57289761,400,20736,6724,48,16,50625,30,4,3600,9604,1764,1679616,10,3748096,14776336,4096,92236816,104976,6889,256,83,43046721,1600,390625,1679616,8100,7921,14,6250000,2916,4096,16,38416,9150625,98,24,1679616,12117361,61,26873856,11316496,7225,87,14776336,30,66,1444,2500,4096,71639296,1500625,40,63,2704,37015056,33,4879681,57,14,42,31640625,2,28561,4,72,95,331776,8503056,2025,90,65,57,6561,625,289,2809,1874161,55,130321,63,24010000,72,51,256,72,1849,7890481,7225,92,5764801,18974736,15752961,2560000,1185921,7311616,93,57289761,11,7056,33,71,65536,89,3111696,17850625,9025,3,99,1225,4,169,1369,24010000,14,121,9,2085136,194481,63,9409,53,6724,18974736,4624,89,62742241,49787136,7890481,91,3111696,11316496,39,49,8281,923521,4900,31640625,1764,66,67,84934656,55,3111696,9150625,32,256,1679616,1048576,2085136,5308416,7921,52,2825761,54700816,74,8100,3025,1444,3600,784,2401,4356,64,18974736,1024,44,2401,16,66,6561,2500,3600,69,26873856,3025,39,52,531441,76,89,35,65610000,90,37015056,196,50,84,12960000,14641,64,1296,11,50625,196,1296,65536,3111696,65,4356,576,15752961,99,38416,20736,37,93,54,8100,256,81,256,10,1679616,13845841,2401,196,3481,18,65536,8100,256,5776,6084,53,1369,17850625,86,50,66,169,3249,12117361,7396,21,7921,234256,5308416,5476,7225,49,3111696,1874161,65610000,4100625,71639296,5041,99,810000,6,77,87,5329,324,4761,86,810000,35153041,121,2209,361,1849,1089,93,64,16,7396,91,1444,68574961,900,75,6724,44,1936,60,3748096,1764,576,2500,2916,104976,65536,14641,104976,73,7,8464,24010000,52200625,16777216,64,256,5929,74805201,2916,68574961,144,3249,2401,52,15,3,1296,10556001,7569,37,121,31640625,25,7396,41,65536,7225,70,4761,28398241,4225,2825761,43046721,65,6889,12960000,45,2,84934656,98,96059601,81,614656,76,45,23,14,4356,81,47,441,3418801,121,6561,214358881,93,7396,456976,1185921,16,6765201,25,8281,47,8100,33362176,45,2085136,2560000,5764801,65610000,66,3748096,1936,5625,390625,22,33,18974736,1225,32,25,79,16777216,16777216,5929,5625,3748096,46,31640625,6561,38416,92,1048576,2304,1444,54,961,60,4096,49787136,456976,4100625,5041,56,8100,7569,64,4477456,3,6765201,6561,1369,20736,8281,93,20151121,2601,14641,1024,81,92,46,130321,1225,83521,52,22667121,57289761,14776336,45212176,3,5625,38,2116,54700816,62,15,4356,14641,7225,12,6250000,1048576,2560000,55,38416,7569,87,256,47,961,3844,99,4,1936,33362176,16,3111696,87,3249,51,9801,5,67,78,18,70,130321,38,90,1874161,42,1296,16,6561,74805201,90,5764801,81450625,8649,90,20,576,3748096,279841,9,40960000,3,48,390625,4477456,74,57,1600,5329,2704,1089,279841,5184,8649,9604,5764801,15,961,73,76,70,57289761,5625,86,6561,29,14,4900,44,4900,18,2601,68574961,72,90,91,529,21,96059601,7056,44,214358881,9,1681,810000,82,529,2825761,89,52200625,32,8649,74805201,19,400,6889,9801,27,3,97,1600,279841,49,1936,47,3844,20151121,83,8,22667121,225,43046721,390625,7569,1444,484,1024,75,16,62,25411681,64,29986576,20151121,15,69,43046721,38,64,104976,331776,6241,94,31,43046721,26,12960000,49787136,28561,2401,22,6241,65536,59,625,4,37,1936,10556001,361,6084,1849,7396,62742241,59,1681,3600,4879681,2085136,2560000,6250000,12117361,40960000,1185921,4,93,12960000,1936,1296,17,75,12,65536,51,5764801,50625,6400,3748096,81,23,2601,8100,80,7921,85,74805201,46,47458321,429981696,37,18974736,8100,74805201,214358881,196,16777216,1369,57289761,4489,22667121,3748096,2601,2304,7,12,82,6400,58,60,100,100000000,68574961,96,54700816,16,38950081,93,92236816,1600,6889,47458321,279841,60,3600,43046721,74805201,25411681,95,81,70,93,8,6561,4761,54,1444,92236816,71639296,18974736,81,12960000,47458321,28561,32,98,6561,37015056,4356,17,6889,169,1936,121,4,100,2085136,8649,83,815730721,31,529,33,2601,3721,729,43,26873856,160000,5929,21,43046721,38416,2304,77,15752961,4900,2,65,4624,15752961,9834496,87,8281,676,7890481,41,225,14641,4096,6250000,1024,9,44,43046721,54,324,7890481,3748096,4,4,1764,7,1764,75,33362176,3481,47458321,65536,1681,26,87,4489,484,35,78074896,89,24,5764801,194481,90,2704,8,100,6765201,34,3969,1156,98,37015056,65610000,59,85,25,3969,3136,8464,54700816,52,1681,16,100000000,8464,8,36,810000,625,2085136,82,625,68574961,72,38416,4879681,79,26873856,1849,48,26873856,2809,68574961,7056,1048576,1024,2025,923521,50625,1764,289,35,676,7311616,2209,256,38950081,71639296,62,92,4,91,4096,69,65610000,529,390625,18974736,80,57,2916,50625,4225,4900,28,7311616,289,66,2313441,51,16777216,8503056,16,7569,8281,2560000,10,52200625,331776,83521,62742241,13,84,96059601,50,24,52200625,4096,25,67,2401,18,12117361,2825761,8,35153041,5308416,2025,22667121,3481,9,17850625,5776,2116,1521,36,30,11,91,62742241,23,279841,86,194481,81,64,33362176,45212176,65536,6765201,78,48,62742241,2809,85,5308416,42,52200625,67,4225,4096,441,28561,30,78,16777216,331776,62742241,625,5184,815730721,4477456,16777216,64,8649,16777216,51,6765201,33,12117361,3481,83,79,256,20,2704,35153041,9604,1679616,8503056,65536,100,5184,9025,83,70,14,4761,83,91,81450625,13,2209,3418801,100000000,89,169,1500625,1089,4100625,1444,40,2809,21,88529281,44,85,2025,49,42,4356,26873856,2500,81,8649,38950081,8,441,11,1048576,93,3249,9801,9604,15,26,66,17850625,1500625,2025,5184,5184,194481,74805201,65,1336336,841,65536,4489,1936,48,16777216,324,289,2313441,214358881,4900,10556001,3364,40,84,7311616,14776336,17,4356,9216,4225,17850625,14776336,36,7921,14641,35153041,64,4100625,5776,5,75,16,2,36,6724,93,3364,8,1521,4096,98,2304,5308416,429981696,1089,576,45,72,45,3,1048576,28398241,10000,24010000,100000000,6250000,8649]
 */